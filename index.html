<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hunter 的每日任務抽籤</title>
  <style>
    body{
      margin:0; font-family:"Minecraftia", monospace, sans-serif;
      background: #6db36d url("background.png") repeat;
      background-size:64px 64px;
      color:#fff; text-align:center; padding:20px;
    }
    h1{ font-size:1.8rem; text-shadow:2px 2px #333; }
    .card{ background:#3c3c3c; border:4px solid #000; padding:16px; margin:12px auto; max-width:480px; }
    .task{ font-size:1.3rem; margin:12px 0; padding:10px; background:#222; border:2px solid #555; }
    button{
      font-family:"Minecraftia", monospace, sans-serif;
      padding:10px 16px; margin:6px; border:3px solid #000; background:#8b5;
      color:#fff; cursor:pointer; text-transform:uppercase;
    }
    button:hover{ background:#7a4; }
    .xp-bar{
      width:100%; background:#333; border:3px solid #000; height:24px; margin-top:12px;
      position:relative;
    }
    .xp-fill{
      background:#4caf50; height:100%; width:0%; transition:width .4s;
    }
    .xp-text{ position:absolute; top:0; left:50%; transform:translateX(-50%); font-size:0.9rem; color:#fff; }
    #rewardBtn{ background:#b76e79; margin-top:10px; }
    #resetBtn{ background:#555; margin-top:10px; }
    #resetAllBtn{ background:#c33; margin-top:10px; }

    /* 動畫特效 */
    .xp-float{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      font-size:2rem; font-weight:bold; color:#0f0;
      animation: floatUp 1s ease-out forwards;
      pointer-events:none;
      text-shadow:2px 2px #000;
    }
    @keyframes floatUp{
      0%{opacity:1; transform:translate(-50%,-50%) scale(1);}
      100%{opacity:0; transform:translate(-50%,-150%) scale(1.5);}
    }
  </style>
</head>
<body>
  <h1>Hunter 的每日任務抽籤</h1>

  <div class="card">
    <div>今天的任務</div>
    <div class="task" id="todayTask">尚未指定</div>
    <button id="completeBtn">完成任務 ✔</button>
  </div>

  <div class="card">
    <div>下一個上學日的任務</div>
    <div class="task" id="nextTask">尚未抽籤</div>
    <button id="drawBtn">抽任務</button>
    <button id="redrawBtn">重抽</button>
    <button id="clearBtn">清除</button>
  </div>

  <div class="card">
    <div>積分系統</div>
    <div class="xp-bar">
      <div class="xp-fill" id="xpFill"></div>
      <div class="xp-text" id="xpText">0 / 5</div>
    </div>
    <div id="rewardMsg" style="margin-top:10px; color:#ff0; font-weight:bold"></div>
    <button id="rewardBtn" style="display:none">兌換 Minecraft 時間 🎮</button>
    <button id="resetBtn">清空積分</button>
    <button id="resetAllBtn">清空所有資料</button>
  </div>

  <script>
    const TASKS = [
      "今天老師用了什麼顏色的粉筆寫字？",
      "注意老師今天穿什麼顏色的衣服。",
      "看一看教室裡有幾扇窗戶。",
      "今天操場上有沒有看到新的東西？",
      "下課時有沒有人在玩球？",
      "下課時看到有沒有人在操場跑步？",
      "今天下課時有沒有聽到有人笑？",
      "書包裡的課本排好順序。",
      "確認鉛筆盒裡面有 6 枝鉛筆、2 塊橡皮擦、1 把尺、1 支彩虹筆。",
      "進教室後，小聲說『我完成任務了』。",
      "今天至少舉一次手（回答點名也算）。",
      "下課時跑三圈或走三圈操場。",
      "今天上課時認真聽，記住老師講的一句話。",
      "放學前心裡數一數今天上了幾節課。",
      "跟隔壁的同學說『早安』。",
      "下課時跟一位同學笑一笑或揮手。",
      "問一位同學最喜歡的顏色是什麼。",
      "放學時跟一位同學說『掰掰』。",
      "下課時問同學『你要去哪裡玩？』",
      "下課時跟同學說一句話（嗨、你好都可以）。"
    ];

    const KEY_TASKS = 'hunterAssignments';
    const KEY_POINTS = 'hunterPoints';
    const KEY_LAST_DONE = 'hunterLastDone';

    function loadAssignments(){
      try{ return JSON.parse(localStorage.getItem(KEY_TASKS))||{}; }catch{ return {}; }
    }
    function saveAssignments(a){ localStorage.setItem(KEY_TASKS, JSON.stringify(a)); }
    function loadPoints(){ return parseInt(localStorage.getItem(KEY_POINTS)||'0'); }
    function savePoints(p){ localStorage.setItem(KEY_POINTS, p); }

    function randomTask(){ return TASKS[Math.floor(Math.random()*TASKS.length)]; }

    const todayTaskEl = document.getElementById('todayTask');
    const nextTaskEl = document.getElementById('nextTask');
    const xpFill = document.getElementById('xpFill');
    const xpText = document.getElementById('xpText');
    const rewardMsg = document.getElementById('rewardMsg');
    const rewardBtn = document.getElementById('rewardBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resetAllBtn = document.getElementById('resetAllBtn');

    function toDateStr(d){ return d.toISOString().split('T')[0]; }

    function render(){
      const todayStr = toDateStr(new Date());
      const a = loadAssignments();

      // 如果今天還沒有任務但昨天抽了 next，則搬過來
      if(!a[todayStr] && a['next']){
        a[todayStr] = a['next'];
        delete a['next'];
        saveAssignments(a);
      }

      todayTaskEl.textContent = a[todayStr] || '尚未指定';
      nextTaskEl.textContent = a['next'] || '尚未抽籤';

      const pts = loadPoints();
      xpFill.style.width = (pts/5*100)+"%";
      xpText.textContent = pts+" / 5";

      if(pts>=5){
        rewardMsg.textContent = "恭喜！可以換 20 分鐘 Minecraft 🎮";
        rewardBtn.style.display='inline-block';
      } else {
        rewardMsg.textContent = "";
        rewardBtn.style.display='none';
      }
    }

    document.getElementById('drawBtn').onclick=()=>{
      const a = loadAssignments();
      a['next'] = randomTask();
      saveAssignments(a);
      render();
    };
    document.getElementById('redrawBtn').onclick=()=>{
      const a = loadAssignments();
      a['next'] = randomTask();
      saveAssignments(a);
      render();
    };
    document.getElementById('clearBtn').onclick=()=>{
      const a = loadAssignments();
      delete a['next'];
      saveAssignments(a);
      render();
    };

    document.getElementById('completeBtn').onclick=()=>{
      const todayStr = toDateStr(new Date());
      const lastDone = localStorage.getItem(KEY_LAST_DONE);
      if(lastDone===todayStr){ alert('今天已經完成過任務囉！'); return; }
      let pts = loadPoints();
      pts++;
      savePoints(pts);
      localStorage.setItem(KEY_LAST_DONE, todayStr);
      showXpFloat("+1 XP");
      render();
    };

    rewardBtn.onclick=()=>{
      let pts = loadPoints();
      if(pts>=5){
        pts -= 5;
        savePoints(pts);
        alert('兌換成功，可以玩 20 分鐘 Minecraft！');
        render();
      }
    };

    resetBtn.onclick=()=>{
      if(confirm('確定要清空積分嗎？')){
        savePoints(0);
        render();
      }
    };

    resetAllBtn.onclick=()=>{
      if(confirm('確定要清空所有資料嗎？（任務與積分都會刪除）')){
        localStorage.removeItem(KEY_POINTS);
        localStorage.removeItem(KEY_TASKS);
        localStorage.removeItem(KEY_LAST_DONE);
        render();
      }
    };

    function showXpFloat(text){
      const el=document.createElement('div');
      el.className='xp-float';
      el.textContent=text;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),1000);
    }

    render();
  </script>
</body>
</html>
