<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hunter çš„æ¯æ—¥ä»»å‹™æŠ½ç±¤</title>
  <style>
    @font-face {
      font-family: 'Cubic11';
      src: url('./Cubic_11.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    body{
      margin:0; font-family:"Cubic11", monospace, sans-serif;
      background: linear-gradient(135deg, #6db36d, #4a7f4a);
      color:#fff; text-align:center; padding:20px;
    }
    h1{ font-size:1.8rem; text-shadow:2px 2px #333; }
    .card{ background:rgba(60,60,60,0.85); border:4px solid #000; padding:16px; margin:12px auto; max-width:480px; border-radius:8px; }
    .task{ font-size:1.3rem; margin:12px 0; padding:10px; background:rgba(34,34,34,0.9); border:2px solid #555; border-radius:4px; }
    .done{ color:#0f0; font-size:1rem; margin-top:6px; }
    button{
      font-family:"Cubic11", monospace, sans-serif;
      padding:10px 16px; margin:6px; border:3px solid #000; background:#8b5;
      color:#fff; cursor:pointer; text-transform:uppercase;
    }
    button:hover{ background:#7a4; }
    button.small{
      font-size:0.7rem; padding:4px 8px; margin:4px;
      background:#666; border:2px solid #444;
    }
    button.small:hover{ background:#555; }
    .xp-bar{
      width:100%; background:#333; border:3px solid #000; height:24px; margin-top:12px;
      position:relative;
    }
    .xp-fill{
      background:#4caf50; height:100%; width:0%; transition:width .4s;
    }
    .xp-text{ position:absolute; top:0; left:50%; transform:translateX(-50%); font-size:0.9rem; color:#fff; }
    ul{ text-align:left; margin:10px auto; max-width:400px; }
    li{ margin:4px 0; }
  </style>
</head>
<body>
  <h1>Hunter çš„æ¯æ—¥ä»»å‹™æŠ½ç±¤</h1>

  <div class="card">
    <div>ä»Šå¤©çš„ä»»å‹™</div>
    <div class="task" id="todayTask">å°šæœªæŒ‡å®š</div>
    <div id="doneMark" class="done"></div>
    <button id="completeBtn">å®Œæˆä»»å‹™ âœ”</button>
  </div>

  <div class="card">
    <div>ä¸‹ä¸€å€‹ä¸Šå­¸æ—¥çš„ä»»å‹™</div>
    <div class="task" id="nextTask">å°šæœªæŠ½ç±¤</div>
    <button id="drawBtn">æŠ½ä»»å‹™</button>
    <button id="redrawBtn">é‡æŠ½</button>
    <button id="clearBtn">æ¸…é™¤</button>
  </div>

  <div class="card">
    <div>ç©åˆ†ç³»çµ±</div>
    <div class="xp-bar">
      <div class="xp-fill" id="xpFill"></div>
      <div class="xp-text" id="xpText">0 / 5</div>
    </div>
    <div id="rewardMsg" style="margin-top:10px; color:#ff0; font-weight:bold"></div>
    <button id="redeemBtn" style="display:none; background:#d85">å…Œæ› Minecraft 20 åˆ†é˜</button>
  </div>

  <div class="card">
    <div>ä»»å‹™æ­·å²ç´€éŒ„ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰</div>
    <ul id="historyList"></ul>
    <button id="clearHistoryBtn" class="small">æ¸…é™¤æ­·å²</button>
  </div>

  <div class="card">
    <div>æ¸¬è©¦å·¥å…·ï¼ˆåƒ…å¤§äººä½¿ç”¨ï¼‰</div>
    <button id="simulateBtn" class="small">æ¨¡æ“¬éš”å¤©æ¬ç§»</button>
  </div>

  <script>
    const TASKS = [
      "ä»Šå¤©è€å¸«ç”¨äº†ä»€éº¼é¡è‰²çš„ç²‰ç­†å¯«å­—ï¼Ÿ",
      "è€å¸«ä»Šå¤©ç©¿ä»€éº¼é¡è‰²çš„è¡£æœã€‚",
      "çœ‹ä¸€çœ‹æ•™å®¤è£¡æœ‰å¹¾æ‰‡çª—æˆ¶ã€‚",
      "ä»Šå¤©æ“å ´ä¸Šæœ‰æ²’æœ‰çœ‹åˆ°æ–°çš„æ±è¥¿ï¼Ÿ",
      "ä¸‹èª²æ™‚æœ‰æ²’æœ‰åŒå­¸åœ¨ç©çƒï¼Ÿ",
      "ä¸‹èª²æ™‚çœ‹åˆ°æœ‰æ²’æœ‰åŒå­¸åœ¨æ“å ´è·‘æ­¥ï¼Ÿ",
      "ä»Šå¤©ä¸‹èª²æ™‚æœ‰æ²’æœ‰è½åˆ°æœ‰äººç¬‘ï¼Ÿ",
      "æ›¸åŒ…è£¡çš„èª²æœ¬æ’å¥½é †åºã€‚",
      "ç¢ºèªé‰›ç­†ç›’è£¡é¢æœ‰æ²’æœ‰å±¬æ–¼è‡ªå·±çš„ 6 æé‰›ç­†ã€2 å¡Šæ©¡çš®æ“¦ã€1 æŠŠå°ºã€1 æ”¯å½©è™¹ç­†ã€‚",
      "é€²æ•™å®¤å¾Œï¼Œå°è²èªªã€æˆ‘å®Œæˆä»»å‹™äº†ã€ã€‚",
      "ä»Šå¤©è‡³å°‘èˆ‰ä¸€æ¬¡æ‰‹ï¼ˆå›ç­”é»åä¹Ÿç®—ï¼‰ã€‚",
      "ä¸‹èª²æ™‚è·‘ä¸‰åœˆæˆ–èµ°ä¸‰åœˆæ“å ´ã€‚",
      "ä»Šå¤©ä¸Šèª²æ™‚èªçœŸè½ï¼Œè¨˜ä½è€å¸«è¬›çš„ä¸€å¥è©±ã€‚",
      "æ”¾å­¸å‰ï¼Œå¿ƒè£¡æ•¸ä¸€æ•¸ä»Šå¤©ä¸Šäº†å¹¾ç¯€èª²ã€‚",
      "è·Ÿéš”å£çš„åŒå­¸èªªã€æ—©å®‰ã€ã€‚",
      "ä¸‹èª²æ™‚è·Ÿä¸€ä½åŒå­¸ç¬‘ä¸€ç¬‘æˆ–æ®æ‰‹ã€‚",
      "å•ä¸€ä½åŒå­¸æœ€å–œæ­¡çš„é¡è‰²æ˜¯ä»€éº¼ã€‚",
      "æ”¾å­¸æ™‚è·Ÿä¸€ä½åŒå­¸èªªã€æ°æ°ã€ã€‚",
      "ä¸‹èª²æ™‚å•åŒå­¸ã€ä½ è¦å»å“ªè£¡ç©ï¼Ÿã€",
      "ä¸‹èª²æ™‚è·ŸåŒå­¸èªªä¸€å¥è©±ï¼ˆå—¨ã€ä½ å¥½ï¼Œéƒ½å¯ä»¥ï¼‰ã€‚"
    ];

    const KEY_TASKS = 'hunterAssignments';
    const KEY_POINTS = 'hunterPoints';

    function loadAssignments(){
      try{ return JSON.parse(localStorage.getItem(KEY_TASKS))||{}; }catch{ return {}; }
    }
    function saveAssignments(a){ localStorage.setItem(KEY_TASKS, JSON.stringify(a)); }
    function loadPoints(){ return parseInt(localStorage.getItem(KEY_POINTS)||'0'); }
    function savePoints(p){ localStorage.setItem(KEY_POINTS, p); }

    function randomTask(){ return TASKS[Math.floor(Math.random()*TASKS.length)]; }

    const todayTaskEl = document.getElementById('todayTask');
    const nextTaskEl = document.getElementById('nextTask');
    const xpFill = document.getElementById('xpFill');
    const xpText = document.getElementById('xpText');
    const rewardMsg = document.getElementById('rewardMsg');
    const redeemBtn = document.getElementById('redeemBtn');
    const historyListEl = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const doneMark = document.getElementById('doneMark');

    function isSchoolDay(d){
      const day = d.getDay();
      return day>=1 && day<=5; // é€±ä¸€åˆ°é€±äº”
    }

    function moveNextToToday(){
      const a = loadAssignments();
      const todayStr = new Date().toDateString();
      if(isSchoolDay(new Date()) && !a[todayStr] && a['next']){
        a[todayStr] = a['next'];
        delete a['next'];
        saveAssignments(a);
      }
    }

    function formatDateStr(dateStr){
      const d = new Date(dateStr);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      const week = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d.getDay()];
      return `${y}-${m}-${day}ï¼ˆé€±${week}ï¼‰`;
    }

    function render(){
      moveNextToToday();
      const a = loadAssignments();
      const todayStr = new Date().toDateString();
      const today = a[todayStr];
      todayTaskEl.textContent = today? today : 'å°šæœªæŒ‡å®š';

      if(a['done_'+todayStr]){
        doneMark.textContent = 'âœ” ä»Šå¤©çš„ä»»å‹™å·²å®Œæˆ';
      } else {
        doneMark.textContent = '';
      }

      const next = a['next'];
      nextTaskEl.textContent = next? next : 'å°šæœªæŠ½ç±¤';

      const pts = loadPoints();
      const rewards = Math.floor(pts / 5);  // å¯å…Œæ›æ¬¡æ•¸
      const current = pts % 5;              // ç•¶å‰é€²åº¦
      const percent = (current/5)*100;

      xpFill.style.width = percent+"%";
      xpText.textContent = current+" / 5 (å¯å…Œæ› "+rewards+" æ¬¡)";

      if (rewards > 0){
        rewardMsg.textContent = "æ­å–œï¼ä½ å¯ä»¥æ› "+rewards+" æ¬¡ 20 åˆ†é˜ Minecraft ğŸ®";
        redeemBtn.style.display = 'inline-block';
      } else {
        rewardMsg.textContent = "";
        redeemBtn.style.display = 'none';
      }

      // ä»»å‹™æ­·å²ç´€éŒ„ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰
      const keys = Object.keys(a).filter(k=>k!=='next').sort((x,y)=> new Date(x)-new Date(y));
      const recent = keys.slice(-10);
      historyListEl.innerHTML = recent.map(k=>`<li>${formatDateStr(k)}ï¼š${a[k]}</li>`).join('');
    }

    document.getElementById('drawBtn').onclick=()=>{
      const a = loadAssignments();
      a['next'] = randomTask();
      saveAssignments(a);
      render();
    };
    document.getElementById('redrawBtn').onclick=()=>{
      const a = loadAssignments();
      a['next'] = randomTask();
      saveAssignments(a);
      render();
    };
    document.getElementById('clearBtn').onclick=()=>{
      const a = loadAssignments();
      delete a['next'];
      saveAssignments(a);
      render();
    };

    document.getElementById('completeBtn').onclick=()=>{
      const todayStr = new Date().toDateString();
      const a = loadAssignments();
      if(a['done_'+todayStr]){
        alert("ä»Šå¤©çš„ä»»å‹™å·²ç¶“å®Œæˆéäº†ï¼");
        return;
      }
      let pts = loadPoints();
      pts++;
      savePoints(pts);
      a['done_'+todayStr] = true; // æ¨™è¨˜ä»Šå¤©å®Œæˆé
      saveAssignments(a);
      render();
    };

    redeemBtn.onclick=()=>{
      let pts = loadPoints();
      if(pts >= 5){
        pts -= 5;
        savePoints(pts);
        alert("å·²å…Œæ› 20 åˆ†é˜ Minecraftï¼Œç©åˆ†æ‰£é™¤ 5 é»ï¼");
        render();
      }
    };

    function passwordCheck(){
      const input = prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š");
      return input === "1234"; // å¯è‡ªè¡Œä¿®æ”¹å¯†ç¢¼
    }

    document.getElementById('simulateBtn').onclick=()=>{
      if(!passwordCheck()) return;
      const a = loadAssignments();
      const todayStr = new Date().toDateString();
      if(a['next']){
        a[todayStr] = a['next'];
        delete a['next'];
        saveAssignments(a);
        alert("æ¨¡æ“¬å®Œæˆï¼šå·²å°‡ä¸‹ä¸€å€‹ä»»å‹™æ¬åˆ°ä»Šå¤©");
        render();
      } else {
        alert("ç›®å‰æ²’æœ‰ä¸‹ä¸€å€‹ä»»å‹™å¯æ¬ç§»");
      }
    };

    clearHistoryBtn.onclick=()=>{
      if(!passwordCheck()) return;
      if(confirm("ç¢ºå®šè¦æ¸…é™¤æ­·å²ç´€éŒ„å—ï¼Ÿ")){
        const a = loadAssignments();
        for(const k of Object.keys(a)){
          if(k!=='next') delete a[k];
        }
        saveAssignments(a);
        render();
      }
    };

    render();
  </script>
</body>
</html>
